# 智慧過濾規則

## 概述

Stop hook 會在對話結束時分析內容，只儲存重要的記憶，避免垃圾資訊污染記憶庫。

## 會儲存的內容

### 儲存模式 (Save Patterns)

以下模式的內容會被自動儲存：

| 類型 | 模式範例 |
|------|----------|
| 偏好 | `我喜歡...`, `用戶偏好...`, `prefer...` |
| 負面偏好 | `我不喜歡...`, `討厭...`, `dislike...` |
| 決定 | `決定使用...`, `chosen...`, `selected...` |
| 明確記憶 | `記住...`, `remember...`, `note that...` |
| 設定 | `設定...`, `config...`, `setting...` |
| 事實 | `工作於...`, `住在...`, `located...` |
| 專案決策 | `專案使用...`, `架構決定...` |

### 範例（會儲存）

```
✓ "我喜歡用 Neovim 寫程式"
✓ "決定這個專案使用 PostgreSQL"
✓ "記住我的暱稱是吹吹"
✓ "專案架構決定採用 microservices"
```

## 不會儲存的內容

### 噪音模式 (Noise Patterns)

以下模式會被忽略：

| 類型 | 模式範例 |
|------|----------|
| 簡短確認 | `ok`, `好的`, `是的`, `沒問題` |
| 感謝 | `謝謝`, `thanks` |
| 請求 | `請...`, `can you...`, `could you...` |
| 問題 | `什麼是...`, `怎麼...`, `如何...` |
| 錯誤訊息 | `error`, `錯誤`, `failed` |

### 範例（不會儲存）

```
✗ "ok"
✗ "謝謝幫忙"
✗ "請幫我修改這個檔案"
✗ "什麼是 TypeScript?"
✗ "這個 error 怎麼解決?"
```

## 其他過濾條件

### 最小長度

內容必須至少 **50 字元** 才會被考慮儲存。

### 去重複

同一個 source（如 `project:kiroku-memory`）在 **24 小時內** 不會重複儲存相同內容。

使用 MD5 hash 比對：
```
hash(source + ":" + content)
```

### 數量限制

每次對話最多儲存 **3 筆** 記憶，避免過度儲存。

## 快取位置

去重複快取儲存在：
```
~/.cache/kiroku-memory/recent_saves.json
```

格式：
```json
{
  "saves": [
    {"hash": "abc123...", "ts": 1706745600.0}
  ],
  "last_cleanup": "2026-01-31T12:00:00"
}
```

## 自訂過濾

如需調整過濾規則，編輯：
```
~/.claude/skills/kiroku-memory/hooks/stop.py
```

修改 `SAVE_PATTERNS` 和 `NOISE_PATTERNS` 陣列。
